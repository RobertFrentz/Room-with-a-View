¥d
ÖC:\Users\alexg\Documents\GitHub\Room-with-a-View\UserManagementMicroservice\UserManagementMicroservice\Controllers\UsersController.cs
	namespace

 	&
UserManagementMicroservice


 $
.

$ %
Controllers

% 0
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
UsersController  
:! "
ControllerBase# 1
{ 
private 
readonly 
IUsersRepository )
_repository* 5
;5 6
public 
UsersController 
( 
IUsersRepository /

repository0 :
): ;
{ 	
_repository 
= 

repository $
;$ %
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
GetAllAsync) 4
(4 5
[5 6

FromHeader6 @
]@ A
stringB H
authorizationTokenI [
)[ \
{ 	
var 
result 
= 
Jwt 
. 
CheckJWT %
(% &
authorizationToken& 8
)8 9
;9 :
if 
( 
! 
Jwt 
. 

IsValidJWT 
(  
result  &
)& '
)' (
{ 
return   
Unauthorized   #
(  # $
new  $ '
Error  ( -
(  - .
result  . 4
)  4 5
)  5 6
;  6 7
}!! 
var"" 
response"" 
="" 
await""  
_repository""! ,
."", -
GetAllAsync""- 8
(""8 9
Jwt""9 <
.""< =
ExtractUserId""= J
(""J K
result""K Q
)""Q R
)""R S
;""S T
if## 
(## 
response## 
==## 
null## 
)## 
{$$ 
return%% 
Unauthorized%% #
(%%# $
new%%$ '
Error%%( -
(%%- .
$str%%. E
)%%E F
)%%F G
;%%G H
}&& 
return'' 
Ok'' 
('' 
response'' 
)'' 
;''  
}(( 	
[** 	
Route**	 
(** 
$str** 
)** 
]**  
[++ 	
HttpGet++	 
]++ 
public-- 
IActionResult-- 
	CheckAuth-- '
(--' (
[--( )

FromHeader--) 3
]--3 4
string--5 ;
authorizationToken--< N
)--N O
{.. 	
var// 
result// 
=// 
Jwt// 
.// 
CheckJWT// $
(//$ %
authorizationToken//% 7
)//7 8
;//8 9
if00 
(00 
!00 
Jwt00 
.00 

IsValidJWT00 
(00  
result00  &
)00& '
)00' (
{11 
return22 
Unauthorized22 #
(22# $
new22$ '
Error22( -
(22- .
result22. 4
)224 5
)225 6
;226 7
}33 
return44 
Ok44 
(44 
result44 
)44 
;44 
}55 	
[77 	
Route77	 
(77 
$str77 
)77 
]77 
[88 	
HttpGet88	 
]88 
public99 
async99 
Task99 
<99 
IActionResult99 '
>99' (
GetAsync99) 1
(991 2
[992 3

FromHeader993 =
]99= >
string99? E
authorizationToken99F X
)99X Y
{:: 	
var;; 
result;; 
=;; 
Jwt;; 
.;; 
CheckJWT;; %
(;;% &
authorizationToken;;& 8
);;8 9
;;;9 :
if<< 
(<< 
!<< 
Jwt<< 
.<< 

IsValidJWT<< 
(<<  
result<<  &
)<<& '
)<<' (
{== 
return>> 
Unauthorized>> #
(>># $
new>>$ '
Error>>( -
(>>- .
result>>. 4
)>>4 5
)>>5 6
;>>6 7
}?? 
var@@ 
response@@ 
=@@ 
await@@  
_repository@@! ,
.@@, -
GetByIdAsync@@- 9
(@@9 :
Jwt@@: =
.@@= >
ExtractUserId@@> K
(@@K L
result@@L R
)@@R S
)@@S T
;@@T U
returnAA 
OkAA 
(AA 
responseAA 
)AA 
;AA  
}BB 	
[DD 	
RouteDD	 
(DD 
$strDD 
)DD 
]DD 
[EE 	
HttpGetEE	 
]EE 
publicFF 
asyncFF 
TaskFF 
<FF 
IActionResultFF '
>FF' (
GetUsernameAsyncFF) 9
(FF9 :
[FF: ;

FromHeaderFF; E
]FFE F
stringFFG M
authorizationTokenFFN `
)FF` a
{GG 	
varHH 
resultHH 
=HH 
JwtHH 
.HH 
CheckJWTHH %
(HH% &
authorizationTokenHH& 8
)HH8 9
;HH9 :
ifII 
(II 
!II 
JwtII 
.II 

IsValidJWTII 
(II 
resultII %
)II% &
)II& '
{JJ 
returnKK 
UnauthorizedKK #
(KK# $
newKK$ '
ErrorKK( -
(KK- .
resultKK. 4
)KK4 5
)KK5 6
;KK6 7
}LL 
varMM 
userMM 
=MM 
awaitMM 
_repositoryMM (
.MM( )
GetByIdAsyncMM) 5
(MM5 6
JwtMM6 9
.MM9 :
ExtractUserIdMM: G
(MMG H
resultMMH N
)MMN O
)MMO P
;MMP Q
ifNN 
(NN 
userNN 
==NN 
nullNN 
)NN 
{OO 
returnPP 
NotFoundPP 
(PP  
newPP  #
ErrorPP$ )
(PP) *
$strPP* ?
)PP? @
)PP@ A
;PPA B
}QQ 
returnRR 
OkRR 
(RR 
JsonConvertRR !
.RR! "
SerializeObjectRR" 1
(RR1 2
newRR2 5
{RR6 7
usernameRR8 @
=RRA B
userRRC G
.RRG H
UsernameRRH P
}RRQ R
)RRR S
)RRS T
;RRT U
}SS 	
[UU 	
RouteUU	 
(UU 
$strUU 
)UU 
]UU 
[VV 	
HttpPostVV	 
]VV 
publicWW 
asyncWW 
TaskWW 
<WW 
IActionResultWW '
>WW' (
RegisterAsyncWW) 6
(WW6 7
[WW7 8
FromBodyWW8 @
]WW@ A
UserRegisterWWB N
userRegisterWWO [
)WW[ \
{XX 	
varYY 
resultYY 
=YY 
awaitYY 
_repositoryYY *
.YY* +
RegisterAsyncYY+ 8
(YY8 9
userRegisterYY9 E
)YYE F
;YYF G
ifZZ 
(ZZ 
resultZZ 
==ZZ 
-ZZ 
$numZZ 
)ZZ 
{[[ 
return\\ 
Conflict\\ 
(\\  
new\\  #
Error\\$ )
(\\) *
$str\\* @
)\\@ A
)\\A B
;\\B C
}]] 
if^^ 
(^^ 
result^^ 
==^^ 
-^^ 
$num^^ 
)^^ 
{__ 
return`` 
Conflict`` 
(``  
new``  #
Error``$ )
(``) *
$str``* C
)``C D
)``D E
;``E F
}aa 
returnbb 
CreatedAtActionbb "
(bb" #
$strbb# -
,bb- .
userRegisterbb/ ;
)bb; <
;bb< =
}cc 	
[ee 	
Routeee	 
(ee 
$stree 
)ee 
]ee 
[ff 	
HttpPostff	 
]ff 
publicgg 
asyncgg 
Taskgg 
<gg 
IActionResultgg '
>gg' (

LoginAsyncgg) 3
(gg3 4
[gg4 5
FromBodygg5 =
]gg= >
UserCredentialsgg? N
userCredentialsggO ^
)gg^ _
{hh 	
varii 
userIdii 
=ii 
awaitii 
_repositoryii *
.ii* +

LoginAsyncii+ 5
(ii5 6
userCredentialsii6 E
)iiE F
;iiF G
ifjj 
(jj 
userIdjj 
==jj 
-jj 
$numjj 
)jj 
{kk 
returnll 

BadRequestll !
(ll! "
newll" %
Errorll& +
(ll+ ,
$strll, G
)llG H
)llH I
;llI J
}mm 
returnnn 
Oknn 
(nn 
JsonConvertnn !
.nn! "
SerializeObjectnn" 1
(nn1 2
newnn2 5
{nn6 7
jwtnn8 ;
=nn< =
Jwtnn> A
.nnA B
	CreateJWTnnB K
(nnK L
userIdnnL R
,nnR S
$numnnT U
)nnU V
}nnW X
)nnX Y
)nnY Z
;nnZ [
}qq 	
[ss 	
HttpPutss	 
]ss 
publictt 
asynctt 
Tasktt 
<tt 
IActionResulttt '
>tt' (
UpdateAsynctt) 4
(tt4 5
[tt5 6
FromBodytt6 >
]tt> ?
UserRegistertt@ L
userttM Q
,ttQ R
[ttR S

FromHeaderttS ]
]tt] ^
stringtt_ e
authenticationTokenttf y
)tty z
{uu 	
varvv 
resultvv 
=vv 
Jwtvv 
.vv 
CheckJWTvv %
(vv% &
authenticationTokenvv& 9
)vv9 :
;vv: ;
ifww 
(ww 
!ww 
Jwtww 
.ww 

IsValidJWTww 
(ww  
resultww  &
)ww& '
)ww' (
{xx 
returnyy 
Unauthorizedyy #
(yy# $
newyy$ '
Erroryy( -
(yy- .
resultyy. 4
)yy4 5
)yy5 6
;yy6 7
}zz 
bool{{ 
	isUpdated{{ 
={{ 
await{{ "
_repository{{# .
.{{. /
UpdateAsync{{/ :
({{: ;
user{{; ?
,{{? @
Jwt{{A D
.{{D E
ExtractUserId{{E R
({{R S
result{{S Y
){{Y Z
){{Z [
;{{[ \
if|| 
(|| 
!|| 
	isUpdated|| 
)|| 
{}} 
return~~ 
NotFound~~ 
(~~  
new~~  #
Error~~$ )
(~~) *
$str~~* >
)~~> ?
)~~? @
;~~@ A
} 
return
ÄÄ 
	NoContent
ÄÄ 
(
ÄÄ 
)
ÄÄ 
;
ÄÄ 
}
ÅÅ 	
[
ÉÉ 	

HttpDelete
ÉÉ	 
]
ÉÉ 
public
ÑÑ 
async
ÑÑ 
Task
ÑÑ 
<
ÑÑ 
IActionResult
ÑÑ '
>
ÑÑ' (
DeleteAsync
ÑÑ) 4
(
ÑÑ4 5
[
ÑÑ5 6

FromHeader
ÑÑ6 @
]
ÑÑ@ A
string
ÑÑB H!
authenticationToken
ÑÑI \
)
ÑÑ\ ]
{
ÖÖ 	
var
ÜÜ 
result
ÜÜ 
=
ÜÜ 
Jwt
ÜÜ 
.
ÜÜ 
CheckJWT
ÜÜ %
(
ÜÜ% &!
authenticationToken
ÜÜ& 9
)
ÜÜ9 :
;
ÜÜ: ;
if
áá 
(
áá 
!
áá 
Jwt
áá 
.
áá 

IsValidJWT
áá 
(
áá  
result
áá  &
)
áá& '
)
áá' (
{
àà 
return
ââ 
Unauthorized
ââ #
(
ââ# $
new
ââ$ '
Error
ââ( -
(
ââ- .
result
ââ. 4
)
ââ4 5
)
ââ5 6
;
ââ6 7
}
ää 
await
ãã 
_repository
ãã 
.
ãã 
DeleteByIdAsync
ãã -
(
ãã- .
Jwt
ãã. 1
.
ãã1 2
ExtractUserId
ãã2 ?
(
ãã? @
result
ãã@ F
)
ããF G
)
ããG H
;
ããH I
return
åå 
	NoContent
åå 
(
åå 
)
åå 
;
åå 
}
éé 	
}
èè 
}êê ˙

zC:\Users\alexg\Documents\GitHub\Room-with-a-View\UserManagementMicroservice\UserManagementMicroservice\Data\DataContext.cs
	namespace 	&
UserManagementMicroservice
 $
.$ %
Data% )
{ 
public 

class 
DataContext 
: 
	DbContext (
{ 
public		 
DataContext		 
(		 
DbContextOptions		 +
options		, 3
)		3 4
:		5 6
base		7 ;
(		; <
options		< C
)		C D
{

 	
} 	
public 
DbSet 
< 
User 
> 
Users  
{! "
get# &
;& '
set( +
;+ ,
}- .
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
modelBuilder 
. 
Entity 
<  
User  $
>$ %
(% &
)& '
. 
Property !
(! "
user" &
=>' )
user* .
.. /
Id/ 1
)1 2
. 
ValueGeneratedOnAdd ,
(, -
)- .
;. /
} 	
} 
} ÿ
C:\Users\alexg\Documents\GitHub\Room-with-a-View\UserManagementMicroservice\UserManagementMicroservice\Data\IUsersRepository.cs
	namespace 	&
UserManagementMicroservice
 $
.$ %
Data% )
{ 
public 

	interface 
IUsersRepository %
{		 
Task

 
<

 
int

 
>

 
RegisterAsync

 
(

  
UserRegister

  ,
userRegister

- 9
)

9 :
;

: ;
Task 
< 
int 
> 

LoginAsync 
( 
UserCredentials ,
userCredentials- <
)< =
;= >
Task 
< 
IEnumerable 
< 
User 
> 
> 
GetAllAsync  +
(+ ,
int, /
userId0 6
)6 7
;7 8
Task 
< 
User 
> 
GetByIdAsync 
(  
int  #
userId$ *
)* +
;+ ,
Task 
< 
bool 
> 
UpdateAsync 
( 
UserRegister +
user, 0
,0 1
int2 5
userId6 <
)< =
;= >
Task 
DeleteByIdAsync 
( 
int  
userId! '
)' (
;( )
} 
} ÷
ñC:\Users\alexg\Documents\GitHub\Room-with-a-View\UserManagementMicroservice\UserManagementMicroservice\Data\Migrations\20210420162254_InitialCreate.cs
	namespace 	&
UserManagementMicroservice
 $
.$ %
Data% )
.) *

Migrations* 4
{ 
public 

partial 
class 
InitialCreate &
:' (
	Migration) 2
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder		 
.		 
CreateTable		 (
(		( )
name

 
:

 
$str

 
,

 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 :
,: ;
nullable< D
:D E
falseF K
)K L
. 

Annotation #
(# $
$str$ :
,: ;
true< @
)@ A
,A B
Username 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: @
,@ A
nullableB J
:J K
trueL P
)P Q
,Q R
Email 
= 
table !
.! "
Column" (
<( )
string) /
>/ 0
(0 1
type1 5
:5 6
$str7 =
,= >
nullable? G
:G H
trueI M
)M N
,N O
Password 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: @
,@ A
nullableB J
:J K
trueL P
)P Q
,Q R
Role 
= 
table  
.  !
Column! '
<' (
int( +
>+ ,
(, -
type- 1
:1 2
$str3 <
,< =
nullable> F
:F G
falseH M
)M N
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% /
,/ 0
x1 2
=>3 5
x6 7
.7 8
Id8 :
): ;
;; <
} 
) 
; 
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
	DropTable &
(& '
name 
: 
$str 
) 
; 
} 	
} 
}   ÿ>
~C:\Users\alexg\Documents\GitHub\Room-with-a-View\UserManagementMicroservice\UserManagementMicroservice\Data\UsersRepository.cs
	namespace		 	&
UserManagementMicroservice		
 $
.		$ %
Data		% )
{

 
public 

class 
UsersRepository  
:! "
IUsersRepository# 3
{ 
private 
readonly 
DataContext $
context% ,
;, -
public 
UsersRepository 
( 
DataContext *
context+ 2
)2 3
{ 	
this 
. 
context 
= 
context "
;" #
} 	
public 
async 
Task 
< 
int 
> 
RegisterAsync ,
(, -
UserRegister- 9
userRegister: F
)F G
{ 	
if 
( 
this 
. 
context 
. 
Users !
.! "
Any" %
(% &
user& *
=>+ -
user. 2
.2 3
Username3 ;
==< >
userRegister? K
.K L
UsernameL T
)T U
)U V
{ 
return 
- 
$num 
; 
} 
if 
( 
this 
. 
context 
. 
Users !
.! "
Any" %
(% &
user& *
=>+ -
user. 2
.2 3
Email3 8
==9 ;
Cryptography< H
.H I

HashStringI S
(S T
userRegisterT `
.` a
Emaila f
)f g
)g h
)h i
{ 
return 
- 
$num 
; 
} 
User 
registerUser 
= 
new "
User# '
(' (
userRegister( 4
.4 5
Username5 =
,= >
userRegister? K
.K L
EmailL Q
,Q R
userRegisterS _
._ `
Password` h
,h i
$numi j
)j k
;k l
this 
. 
context 
. 
Add 
( 
Cryptography )
.) *
HashUserData* 6
(6 7
registerUser7 C
)C D
)D E
;E F
await   
this   
.   
context   
.   
SaveChangesAsync   /
(  / 0
)  0 1
;  1 2
return!! 
$num!! 
;!! 
}"" 	
public$$ 
async$$ 
Task$$ 
<$$ 
int$$ 
>$$ 

LoginAsync$$ )
($$) *
UserCredentials$$* 9
userCredentials$$: I
)$$I J
{%% 	
var&& 
user&& 
=&& 
await&& 
this&& !
.&&! "
context&&" )
.&&) *
Users&&* /
.&&/ 0
Where&&0 5
(&&5 6
user&&6 :
=>&&; =
user&&> B
.&&B C
Email&&C H
==&&I K
Cryptography&&L X
.&&X Y

HashString&&Y c
(&&c d
userCredentials&&d s
.&&s t
Email&&t y
)&&y z
&&''* ,
user''- 1
.''1 2
Password''2 :
==''; =
Cryptography''> J
.''J K

HashString''K U
(''U V
userCredentials''V e
.''e f
Password''f n
)''n o
)''o p
.''p q 
FirstOrDefaultAsync	''q Ñ
(
''Ñ Ö
)
''Ö Ü
;
''Ü á
if(( 
((( 
user(( 
==(( 
null(( 
)(( 
{)) 
return** 
-** 
$num** 
;** 
}++ 
return,, 
user,, 
.,, 
Id,, 
;,, 
}.. 	
public00 
async00 
Task00 
<00 
bool00 
>00 
UpdateAsync00  +
(00+ ,
UserRegister00, 8
user009 =
,00= >
int00? B
userId00C I
)00I J
{11 	
var22
 
result22 
=22 
this22 
.22 
context22 #
.22# $
Users22$ )
.22) *
Find22* .
(22. /
userId22/ 5
)225 6
;226 7
result33
 
.33 
Username33 
=33 
user33  
.33  !
Username33! )
??33* ,
result33- 3
.333 4
Username334 <
;33< =
result44
 
.44 
Email44 
=44 
Cryptography44 %
.44% &

HashString44& 0
(440 1
user441 5
.445 6
Email446 ;
)44; <
??44= ?
result44@ F
.44F G
Email44G L
;44L M
result55
 
.55 
Password55 
=55 
Cryptography55 (
.55( )

HashString55) 3
(553 4
user554 8
.558 9
Password559 A
)55A B
??55C E
result55F L
.55L M
Password55M U
;55U V
await66
 
this66 
.66 
context66 
.66 
SaveChangesAsync66 -
(66- .
)66. /
;66/ 0
return77
 
true77 
;77 
}88 	
public:: 
async:: 
Task:: 
<:: 
IEnumerable:: %
<::% &
User::& *
>::* +
>::+ ,
GetAllAsync::- 8
(::8 9
int::9 <
userId::= C
)::C D
{;; 	
var<< 
result<< 
=<< 
this<< 
.<< 
context<< %
.<<% &
Users<<& +
.<<+ ,
Find<<, 0
(<<0 1
userId<<1 7
)<<7 8
;<<8 9
if== 
(== 
result== 
==== 
null== 
||== 
result== %
.==% &
Role==& *
!===* ,
$num==, -
)==- .
{>> 
return?? 
null?? 
;?? 
}@@ 
returnAA 
awaitAA 
thisAA 
.AA 
contextAA %
.AA% &
UsersAA& +
.AA+ ,
ToListAsyncAA, 7
(AA7 8
)AA8 9
;AA9 :
}BB 	
publicDD 
asyncDD 
TaskDD 
<DD 
UserDD 
>DD 
GetByIdAsyncDD  ,
(DD, -
intDD- 0
userIdDD1 7
)DD7 8
{EE 	
returnGG 
awaitGG 
thisGG 
.GG 
contextGG %
.GG% &
UsersGG& +
.GG+ ,
	FindAsyncGG, 5
(GG5 6
userIdGG6 <
)GG< =
;GG= >
}HH 	
publicJJ 
asyncJJ 
TaskJJ 
DeleteByIdAsyncJJ )
(JJ) *
intJJ* -
userIdJJ. 4
)JJ4 5
{KK 	
varLL 
userLL 
=LL 
awaitLL 
thisLL !
.LL! "
contextLL" )
.LL) *
UsersLL* /
.LL/ 0
	FindAsyncLL0 9
(LL9 :
userIdLL: @
)LL@ A
;LLA B
thisMM 
.MM 
contextMM 
.MM 
RemoveMM 
(MM  
userMM  $
)MM$ %
;MM% &
awaitNN 
thisNN 
.NN 
contextNN 
.NN 
SaveChangesAsyncNN /
(NN/ 0
)NN0 1
;NN1 2
}PP 	
}QQ 
}RR –
wC:\Users\alexg\Documents\GitHub\Room-with-a-View\UserManagementMicroservice\UserManagementMicroservice\Entities\User.cs
	namespace 	&
UserManagementMicroservice
 $
.$ %
Entities% -
{ 
public 

class 
User 
{ 
public 
User 
( 
) 
{ 	
} 	
public		 
User		 
(		 
string		 
username		 #
,		# $
string		% +
email		, 1
,		1 2
string		3 9
password		: B
,		B C
int		C F
role		G K
)		K L
{

 	
Username 
= 
username 
;  
Email 
= 
email 
; 
Password 
= 
password 
;  
Role 
= 
role 
; 
} 	
public 
User 
( 
int 
Id 
, 
string "
username# +
,+ ,
string- 3
email4 9
,9 :
string; A
passwordB J
)J K
{ 	
this 
. 
Id 
= 
Id 
; 
Username 
= 
username 
;  
Email 
= 
email 
; 
Password 
= 
password 
;  
} 	
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
int 
Role 
{ 
get 
; 
set "
;" #
}$ %
} 
}   Ì

qC:\Users\alexg\Documents\GitHub\Room-with-a-View\UserManagementMicroservice\UserManagementMicroservice\Program.cs
	namespace 	&
UserManagementMicroservice
 $
{ 
public 

static 
class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{		 	
CreateHostBuilder

 
(

 
args

 "
)

" #
.

# $
Build

$ )
(

) *
)

* +
.

+ ,
Run

, /
(

/ 0
)

0 1
;

1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} ∆"
qC:\Users\alexg\Documents\GitHub\Room-with-a-View\UserManagementMicroservice\UserManagementMicroservice\Startup.cs
	namespace

 	&
UserManagementMicroservice


 $
{ 
public 

class 
Startup 
{ 
readonly 
string $
MyAllowedSpecificOrigins 0
=1 2
$str3 J
;J K
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services 
. 
AddControllers #
(# $
)$ %
;% &
services 
. 
AddDbContext !
<! "
DataContext" -
>- .
(. /
options/ 6
=>7 9
{ 
options 
. 
	UseSqlite !
(! "
Configuration" /
./ 0
GetConnectionString0 C
(C D
$strD W
)W X
)X Y
;Y Z
} 
) 
; 
services   
.   
AddCors   
(   
options   $
=>  % '
{!! 
options"" 
."" 
	AddPolicy"" !
(""! "$
MyAllowedSpecificOrigins""" :
,"": ;
builder""< C
=>""D F
{## 
builder$$ 
.$$ 
AllowAnyHeader$$ *
($$* +
)$$+ ,
.%% 
AllowAnyMethod%% #
(%%# $
)%%$ %
.&& 
AllowAnyOrigin&& #
(&&# $
)&&$ %
;&&% &
}'' 
)'' 
;'' 
}(( 
)(( 
;(( 
services** 
.** 
AddTransient** !
<**! "
IUsersRepository**" 2
,**2 3
UsersRepository**4 C
>**C D
(**D E
)**E F
;**F G
services++ 
.++ 
AddSwaggerGen++ "
(++" #
c++# $
=>++% '
{,, 
c-- 
.-- 

SwaggerDoc-- 
(-- 
$str-- !
,--! "
new--# &
OpenApiInfo--' 2
{--3 4
Title--5 :
=--; <
$str--= Y
,--Y Z
Version--[ b
=--c d
$str--e i
}--j k
)--k l
;--l m
}.. 
).. 
;.. 
}// 	
public22 
void22 
	Configure22 
(22 
IApplicationBuilder22 1
app222 5
,225 6
IWebHostEnvironment227 J
env22K N
)22N O
{33 	
if44 
(44 
env44 
.44 
IsDevelopment44 !
(44! "
)44" #
)44# $
{55 
app66 
.66 %
UseDeveloperExceptionPage66 -
(66- .
)66. /
;66/ 0
app77 
.77 

UseSwagger77 
(77 
)77  
;77  !
app88 
.88 
UseSwaggerUI88  
(88  !
c88! "
=>88# %
c88& '
.88' (
SwaggerEndpoint88( 7
(887 8
$str888 R
,88R S
$str88T s
)88s t
)88t u
;88u v
}99 
app;; 
.;; 
UseCors;; 
(;; $
MyAllowedSpecificOrigins;; 0
);;0 1
;;;1 2
app== 
.== 

UseRouting== 
(== 
)== 
;== 
app?? 
.?? 
UseAuthorization??  
(??  !
)??! "
;??" #
appAA 
.AA 
UseEndpointsAA 
(AA 
	endpointsAA &
=>AA' )
{BB 
	endpointsCC 
.CC 
MapControllersCC (
(CC( )
)CC) *
;CC* +
}DD 
)DD 
;DD 
}EE 	
}FF 
}GG π
|C:\Users\alexg\Documents\GitHub\Room-with-a-View\UserManagementMicroservice\UserManagementMicroservice\Utils\Cryptography.cs
	namespace 	&
UserManagementMicroservice
 $
.$ %
Utils% *
{ 
public 

static 
class 
Cryptography $
{ 
static		 
readonly		 
byte		 
[		 
]		 
salt		 #
=		$ %
{		& '
$num		( ,
,		, -
$num		. 2
,		2 3
$num		4 8
,		8 9
$num		: >
,		> ?
$num		@ D
,		D E
$num		F J
,		J K
$num		L P
,		P Q
$num		R V
,		V W
$num		X \
,		\ ]
$num		^ b
,		b c
$num		d h
,		h i
$num		j n
,		n o
$num		p t
,		t u
$num		v z
,		z {
$num			| Ä
,
		Ä Å
$num
		Ç Ü
}
		á à
;
		à â
public

 
static

 
User

 
HashUserData

 (
(

( )
User

) -
user

. 2
)

2 3
{ 	
User 

userHashed 
= 
new !
User" &
(& '
user' +
.+ ,
Username, 4
,4 5

HashString6 @
(@ A
userA E
.E F
EmailF K
)K L
,L M

HashStringN X
(X Y
userY ]
.] ^
Password^ f
)f g
,g h
$numh i
)i j
;j k
return 

userHashed 
; 
} 	
public 
static 
string 

HashString '
(' (
string( .
	plaintext/ 8
)8 9
{ 	
if 
( 
	plaintext 
== 
null  
)  !
{ 
return 
null 
; 
} 
string 
hashed 
= 
Convert #
.# $
ToBase64String$ 2
(2 3
KeyDerivation3 @
.@ A
Pbkdf2A G
(G H
password 
: 
	plaintext 
, 
salt 
: 
salt 
, 
prf 
: 
KeyDerivationPrf  
.  !
HMACSHA1! )
,) *
iterationCount 
: 
$num  
,  !
numBytesRequested 
: 
$num !
/" #
$num$ %
)% &
)& '
;' (
return 
hashed 
; 
} 	
} 
} Ï
uC:\Users\alexg\Documents\GitHub\Room-with-a-View\UserManagementMicroservice\UserManagementMicroservice\Utils\Error.cs
	namespace 	&
UserManagementMicroservice
 $
.$ %
Utils% *
{ 
public 

class 
Error 
{ 
public 
Error 
( 
string 
errorMessage (
)( )
{ 	
this 
. 
ErrorMessage 
= 
errorMessage  ,
;, -
} 	
public		 
string		 
ErrorMessage		 "
{		# $
get		% (
;		( )
set		* -
;		- .
}		/ 0
}

 
} ‡'
sC:\Users\alexg\Documents\GitHub\Room-with-a-View\UserManagementMicroservice\UserManagementMicroservice\Utils\Jwt.cs
	namespace		 	&
UserManagementMicroservice		
 $
.		$ %
Utils		% *
{

 
public 

static 
class 
Jwt 
{ 
public 
static 
string 
	CreateJWT &
(& '
int' *
userId+ 1
,1 2
int3 6
time7 ;
); <
{ 	
var 
token 
= 
new 

JwtBuilder &
(& '
)' (
. 
WithAlgorithm )
() *
new* -
HMACSHA256Algorithm. A
(A B
)B C
)C D
. 

WithSecret &
(& '
$str' Q
)Q R
. 
AddClaim $
($ %
$str% *
,* +
DateTimeOffset, :
.: ;
UtcNow; A
.A B
AddHoursB J
(J K
timeK O
)O P
.P Q
ToUnixTimeSecondsQ b
(b c
)c d
)d e
. 
AddClaim $
($ %
$str% -
,- .
userId/ 5
)5 6
. 
Encode "
(" #
)# $
;$ %
return 
token 
; 
} 	
public 
static 
string 
CheckJWT %
(% &
string& ,
jwt- 0
)0 1
{ 	
string 
json 
; 
try 
{ 
IJsonSerializer 

serializer  *
=+ ,
new- 0
JsonNetSerializer1 B
(B C
)C D
;D E
var 
provider 
= 
new "
UtcDateTimeProvider# 6
(6 7
)7 8
;8 9
IJwtValidator 
	validator '
=( )
new* -
JwtValidator. :
(: ;

serializer; E
,E F
providerG O
)O P
;P Q
IBase64UrlEncoder   !

urlEncoder  " ,
=  - .
new  / 2
JwtBase64UrlEncoder  3 F
(  F G
)  G H
;  H I
IJwtAlgorithm!! 
	algorithm!! '
=!!( )
new!!* -
HMACSHA256Algorithm!!. A
(!!A B
)!!B C
;!!C D
IJwtDecoder"" 
decoder"" #
=""$ %
new""& )

JwtDecoder""* 4
(""4 5

serializer""5 ?
,""? @
	validator""A J
,""J K

urlEncoder""L V
,""V W
	algorithm""X a
)""a b
;""b c
json## 
=## 
decoder## 
.## 
Decode## %
(##% &
jwt##& )
,##) *
$str##+ U
,##U V
verify##W ]
:##] ^
true##_ c
)##c d
;##d e
}$$ 
catch%% 
(%% !
TokenExpiredException%% (
)%%( )
{&& 
return'' 
$str'' *
;''* +
}(( 
catch)) 
()) *
SignatureVerificationException)) 1
)))1 2
{** 
return++ 
$str++ 4
;++4 5
},, 
return-- 
json-- 
;-- 
}.. 	
public00 
static00 
bool00 

IsValidJWT00 %
(00% &
string00& ,
jwt00- 0
)000 1
{11 	
if22 
(22 
jwt22 
==22 
$str22 )
||22* ,
jwt22- 0
==221 3
$str224 Q
)22Q R
{33 
return44 
false44 
;44 
}55 
return66 
true66 
;66 
}77 	
public99 
static99 
int99 
ExtractUserId99 '
(99' (
string99( .
jwt99/ 2
)992 3
{:: 	
string;; 
claims;; 
=;; 
jwt;; 
.;;  
Split;;  %
(;;% &
$char;;& )
);;) *
.;;* +
ToList;;+ 1
(;;1 2
);;2 3
[;;3 4
$num;;4 5
];;5 6
.;;6 7
Split;;7 <
(;;< =
$char;;= @
);;@ A
.;;A B
ToList;;B H
(;;H I
);;I J
[;;J K
$num;;K L
];;L M
;;;M N
string<< 
id<< 
=<< 
claims<< 
.<< 
Remove<< %
(<<% &
claims<<& ,
.<<, -
Length<<- 3
-<<4 5
$num<<6 7
)<<7 8
;<<8 9
return== 
Int32== 
.== 
Parse== 
(== 
id== !
)==! "
;==" #
}>> 	
}?? 
}@@ î
C:\Users\alexg\Documents\GitHub\Room-with-a-View\UserManagementMicroservice\UserManagementMicroservice\Utils\UserCredentials.cs
	namespace 	&
UserManagementMicroservice
 $
.$ %
Entities% -
{ 
public 

class 
UserCredentials  
{ 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
}		 ™
|C:\Users\alexg\Documents\GitHub\Room-with-a-View\UserManagementMicroservice\UserManagementMicroservice\Utils\UserRegister.cs
	namespace 	&
UserManagementMicroservice
 $
.$ %
Entities% -
{ 
public 

class 
UserRegister 
{ 
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
}		 